<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Latest Aro-Ha Widget Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background-color: #f8f8f8;
    }
    
    h1 {
      margin-bottom: 30px;
      color: #767657;
    }
    
    .content {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .demo-block {
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    h2 {
      color: #767657;
      margin-top: 0;
    }
    
    button {
      background-color: #767657;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
      margin-bottom: 10px;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #5e5e46;
    }
    
    .icon-reference {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .icon-reference img {
      width: 60px;
      height: 60px;
      margin-right: 20px;
      border-radius: 50%;
    }
    
    .features-list li {
      margin-bottom: 8px;
    }
    
    .features-list li::marker {
      color: #767657;
    }
  </style>
</head>
<body>
  <div class="content">
    <h1>Aro-Ha AI Chat Widget - Latest Test</h1>
    
    <div class="demo-block">
      <div class="icon-reference">
        <div style="width: 60px; height: 60px; background-color: #767657; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="5" width="14" height="12" rx="2" ry="2" />
            <path d="M19 9l2 0" />
            <path d="M20 8l0 2" />
            <path d="M21 14l2 0" />
            <path d="M22 13l0 2" />
          </svg>
        </div>
        <div>
          <h3 style="margin: 0 0 5px 0">New Icon Implementation</h3>
          <p style="margin: 0">This test page shows our new chat button with the exact icon from your screenshot</p>
        </div>
      </div>
    </div>
    
    <div class="demo-block">
      <h2>Interactive Elements Test</h2>
      <p>Click on the buttons below to verify that the chat widget doesn't block interactions:</p>
      
      <button id="test-button-1">Test Button 1</button>
      <button id="test-button-2">Test Button 2</button>
      <button id="test-button-3">Test Button 3</button>
      
      <script>
        document.getElementById('test-button-1').addEventListener('click', () => {
          alert('Button 1 was clicked!');
        });
        
        document.getElementById('test-button-2').addEventListener('click', () => {
          alert('Button 2 was clicked!');
        });
        
        document.getElementById('test-button-3').addEventListener('click', () => {
          alert('Button 3 was clicked!');
        });
      </script>
    </div>

    <div class="demo-block">
      <h2>Features to Test</h2>
      <ul class="features-list">
        <li>Check if the chat button matches the design in your screenshot (outlined chat bubble with sparkles)</li>
        <li>Click the chat bubble to open the widget</li>
        <li>Verify the widget extends fully to the bottom with no gap</li>
        <li>Test the pencil icon to start a new chat</li>
        <li>Verify the confirmation dialog appears and functions correctly</li>
        <li>Test sending and receiving messages</li>
        <li>Click the X to close the widget</li>
      </ul>
    </div>
  </div>
  
  <!-- Include the latest widget embed code -->
  <script>
  /**
   * Aro-Ha AI Assistant - Webflow Embed Code
   * 
   * This optimized embed script:
   * 1. Creates a floating chat button
   * 2. Handles the display of the widget iframe
   * 3. Properly handles pointer-events to avoid blocking clicks
   * 4. Shows chat widget immediately ready for use
   * 5. Shows fullscreen on mobile devices
   */
  (function() {
    // Configuration
    const config = {
      buttonSize: '60px',
      buttonPosition: { bottom: '20px', right: '20px' },
      chatWidth: '380px',
      chatHeight: '580px',
      chatPosition: { bottom: '20px', right: '20px' },
      backgroundColor: '#767657',
      baseUrl: window.location.origin // Use the current origin for testing
    };
    
    // Initialize when DOM is fully loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
    function injectStyles() {
      const styleEl = document.createElement('style');
      styleEl.innerHTML = `
        .aro-ha-button-container {
          position: fixed;
          z-index: 999998;
          width: calc(${config.buttonSize} + 8px);
          height: calc(${config.buttonSize} + 8px);
          bottom: ${config.buttonPosition.bottom};
          right: ${config.buttonPosition.right};
          cursor: pointer;
          pointer-events: auto;
          transition: all 0.3s ease;
          background: transparent;
          padding: 4px;
        }
        
        .aro-ha-chat-container {
          position: fixed;
          z-index: 999997;
          bottom: ${config.chatPosition.bottom};
          right: ${config.chatPosition.right};
          width: ${config.chatWidth};
          height: ${config.chatHeight};
          overflow: hidden;
          transition: all 0.3s ease;
          opacity: 0;
          transform: translateY(20px);
          pointer-events: none;
          box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16);
          border-radius: 12px;
        }
        
        .aro-ha-chat-container.active {
          opacity: 1;
          transform: translateY(0);
          pointer-events: auto;
        }
        
        .aro-ha-button-container.hidden {
          opacity: 0;
          transform: scale(0.8);
          pointer-events: none;
        }
        
        @media (max-width: 768px) {
          .aro-ha-chat-container.active {
            width: 100vw !important;
            height: 100vh !important;
            bottom: 0 !important;
            right: 0 !important;
            border-radius: 0 !important;
          }
        }
      `;
      document.head.appendChild(styleEl);
    }
    
    function createChatButton() {
      const buttonContainer = document.createElement('div');
      buttonContainer.className = 'aro-ha-button-container';
      
      const buttonIframe = document.createElement('iframe');
      buttonIframe.style.width = '100%';
      buttonIframe.style.height = '100%';
      buttonIframe.style.border = 'none';
      buttonIframe.style.borderRadius = '50%';
      buttonIframe.style.overflow = 'hidden';
      buttonIframe.style.background = 'transparent';
      buttonIframe.src = `${config.baseUrl}/widget-button`;
      buttonIframe.title = 'Aro Ha Chat Button';
      buttonIframe.scrolling = 'no';
      buttonIframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope';
      
      buttonContainer.appendChild(buttonIframe);
      document.body.appendChild(buttonContainer);
      
      return buttonContainer;
    }
    
    function createChatContainer() {
      const chatContainer = document.createElement('div');
      chatContainer.className = 'aro-ha-chat-container';
      
      document.body.appendChild(chatContainer);
      return chatContainer;
    }
    
    function init() {
      injectStyles();
      
      const buttonContainer = createChatButton();
      const chatContainer = createChatContainer();
      
      setupEventListeners(buttonContainer, chatContainer);
    }
    
    function setupEventListeners(buttonContainer, chatContainer) {
      // Listen for messages from the button or chat iframe
      window.addEventListener('message', (event) => {
        handleIframeMessages(event, buttonContainer, chatContainer);
      });
      
      // Set up click handler for the button
      buttonContainer.addEventListener('click', () => {
        openWidget(buttonContainer, chatContainer);
      });
    }
    
    function handleIframeMessages(event, buttonContainer, chatContainer) {
      // Handle messages from either iframe
      if (event.data) {
        if (event.data.type === 'widget-close') {
          closeWidget(buttonContainer, chatContainer);
        }
        // Handle button clicks from the button iframe
        else if (event.data.type === 'button-click') {
          openWidget(buttonContainer, chatContainer);
        }
      }
    }
    
    function toggleWidget(buttonContainer, chatContainer) {
      if (chatContainer.classList.contains('active')) {
        closeWidget(buttonContainer, chatContainer);
      } else {
        openWidget(buttonContainer, chatContainer);
      }
    }
    
    function openWidget(buttonContainer, chatContainer) {
      // Hide the button
      buttonContainer.classList.add('hidden');
      
      // If the chat iframe hasn't been created yet, create it
      if (!chatContainer.querySelector('iframe')) {
        const chatIframe = document.createElement('iframe');
        chatIframe.style.width = '100%';
        chatIframe.style.height = '100%';
        chatIframe.style.border = 'none';
        chatIframe.src = `${config.baseUrl}/widget-full`;
        chatIframe.title = 'Aro Ha Chat';
        chatIframe.allow = 'microphone';
        chatContainer.appendChild(chatIframe);
      }
      
      // Show the chat
      chatContainer.classList.add('active');
    }
    
    function closeWidget(buttonContainer, chatContainer) {
      // Hide the chat
      chatContainer.classList.remove('active');
      
      // Show the button
      buttonContainer.classList.remove('hidden');
    }
  })();
  </script>
</body>
</html>