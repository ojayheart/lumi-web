<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webflow Widget Embed Example</title>
</head>
<body>
  <!-- For testing purposes only - the actual code to paste in Webflow is below -->
  
  <script>
  /**
   * Aro-Ha AI Assistant - Webflow Embed Code
   * 
   * This optimized embed script:
   * 1. Creates a floating chat button
   * 2. Handles the display of the widget iframe
   * 3. Properly handles pointer-events to avoid blocking clicks
   * 4. Shows chat widget immediately ready for use
   * 5. Shows fullscreen on mobile devices
   */
  (function() {
    // Configuration
    const APP_URL = 'https://arohaunifiedchat.replit.app'; // Change this to your actual deployed URL
    
    // Check if on mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    // Create styles
    function injectStyles() {
      const style = document.createElement('style');
      style.textContent = `
        .aro-ha-widget-container {
          position: fixed;
          z-index: 999999;
          pointer-events: none; /* Makes container transparent to clicks by default */
        }
        .aro-ha-widget-button {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 70px;
          height: 70px;
          border-radius: 50%;
          overflow: hidden;
          box-shadow: 0 2px 10px rgba(0,0,0,0.2);
          pointer-events: auto; /* Makes button clickable */
          z-index: 999999;
        }
        .aro-ha-widget-chat {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 380px;
          height: 580px;
          z-index: 999998;
          display: none;
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 5px 40px rgba(0,0,0,0.16);
          pointer-events: auto; /* Makes chat clickable */
        }
      `;
      document.head.appendChild(style);
    }
    
    // Create chat button
    function createChatButton() {
      const buttonContainer = document.createElement('div');
      buttonContainer.className = 'aro-ha-widget-button';
      
      const buttonIframe = document.createElement('iframe');
      buttonIframe.src = `${APP_URL}/widget-button`;
      buttonIframe.style.cssText = `
        width: 100%;
        height: 100%;
        border: none;
      `;
      
      buttonContainer.appendChild(buttonIframe);
      document.body.appendChild(buttonContainer);
      
      return buttonContainer;
    }
    
    // Create chat container
    function createChatContainer() {
      const chatContainer = document.createElement('div');
      chatContainer.className = 'aro-ha-widget-chat';
      
      // Adjust for mobile
      if (isMobile) {
        chatContainer.style.width = '100%';
        chatContainer.style.height = '100%';
        chatContainer.style.bottom = '0';
        chatContainer.style.right = '0';
        chatContainer.style.borderRadius = '0';
      }
      
      document.body.appendChild(chatContainer);
      
      return chatContainer;
    }
    
    // Initialize
    function init() {
      // Inject styles
      injectStyles();
      
      // Create elements
      const buttonContainer = createChatButton();
      const chatContainer = createChatContainer();
      
      // Set up event listeners
      setupEventListeners(buttonContainer, chatContainer);
    }
    
    // Set up event listeners
    function setupEventListeners(buttonContainer, chatContainer) {
      window.addEventListener('message', function(event) {
        handleIframeMessages(event, buttonContainer, chatContainer);
      });
    }
    
    // Handle incoming messages from iframes
    function handleIframeMessages(event, buttonContainer, chatContainer) {
      if (!event.data || typeof event.data !== 'object') return;
      
      // Button click event
      if (event.data.type === 'button-click') {
        openWidget(buttonContainer, chatContainer);
      }
      
      // Widget close event
      if (event.data.type === 'widget-close') {
        closeWidget(buttonContainer, chatContainer);
      }
    }
    
    // Toggle widget visibility
    function toggleWidget(buttonContainer, chatContainer) {
      if (chatContainer.style.display === 'none') {
        openWidget(buttonContainer, chatContainer);
      } else {
        closeWidget(buttonContainer, chatContainer);
      }
    }
    
    // Open widget
    function openWidget(buttonContainer, chatContainer) {
      // Hide button
      buttonContainer.style.display = 'none';
      
      // Show chat container
      chatContainer.style.display = 'block';
      
      // Create chat iframe if it doesn't exist yet
      if (!chatContainer.querySelector('iframe')) {
        const chatIframe = document.createElement('iframe');
        chatIframe.src = `${APP_URL}/widget-full`;
        chatIframe.style.cssText = `
          width: 100%;
          height: 100%;
          border: none;
        `;
        chatIframe.allow = 'microphone';
        chatContainer.appendChild(chatIframe);
      }
    }
    
    // Close widget
    function closeWidget(buttonContainer, chatContainer) {
      // Hide chat container
      chatContainer.style.display = 'none';
      
      // Show button
      buttonContainer.style.display = 'block';
    }
    
    // Start initialization when DOM is loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
  </script>
</body>
</html>